#!/usr/bin/env bash
set -u

sep="	"
{
    current=$(git rev-parse --abbrev-ref HEAD)
    branches=$(git for-each-ref --format='%(refname)' refs/heads/ | sed 's|refs/heads/||')
    for branch in $branches; do
        # Get the description or latest commit.
        desc=$(git config branch."$branch".description | head -n1)
        if [ "$desc" = "" ]; then
            desc=$(git log --color=always --pretty="%C(dim white)%s%C(reset)" -1 "$branch")
        fi

        # Get the latest commit
        date=$(git log --color=always --pretty="%C(blue)%cr%C(reset)" -1 "$branch")

        if [ "$branch" == "$current" ]; then
            # Highlight the active branch
            branch="*$sep\033[0;32m$branch\033[0m"
        else if [[ -n "$(git config branch."$branch".remote)" ]]; then
            # Otherwise highlight branches which have an upstream commit.
            branch="\033[1;35m‚èπ\033[0m$sep$branch"
        else
            branch="$sep$branch"
        fi fi
        echo -e "$branch$sep$desc$sep$date\n"
    done
} | column -t -s "$sep" --output-separator " "
